<!DOCTYPE html>  <html> <head>   <title>4.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               4.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h3>Level 4 - Models and Views Together</h3>

<p>In this level, we are going to expand on the first level
to explore how Models and Views work together in Backbone to
provide clean separation between data and the DOM, which makes it easier
to create complex, modern web applications.</p>

<p>In this level, we are going to start adding some functionality to our
Single Todo application.  At the end of this level, our app will 
allow the user to toggle the status of the TodoItem by checking a checkbox, 
and update the DOM to strikethrough the description if the status is <code>'complete'</code></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Lets first update our <code>TodoView</code> template and add a checkbox.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">TodoView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>we are checking if the <code>status</code> is equal to <code>'complete'</code>
so we can start the checkbox as checked.  We'll see how this is important
in a couple of slides.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">template</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s1">&#39;&lt;h3&gt;&lt;input type=checkbox &lt;%= status == &quot;complete&quot; ? &quot;checked=checked&quot; : &quot;&quot; %&gt;/&gt; &lt;%= description %&gt;&lt;/h3&gt;&#39;</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>now in our render function, when we call the <code>template</code> function,
we will pass in the results of <code>this.model.toJSON()</code>, which will just
be a plain object of key/value pairs that represent the model's attributes:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()));</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>We want to call a function on this View whenever the user
checks or unchecks the checkbox.</p>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Let's use the <code>events</code> declaration we learned about in Level 3
to trigger a function whenever the <code>change</code> event is fired on our
input element</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;change input&#39;</span><span class="o">:</span> <span class="s1">&#39;toggleStatus&#39;</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>All that is left is to implement the <code>toggleStatus</code> function.
Let's start with just updating the model based on it's current status.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">toggleStatus</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;incomplete&#39;</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="o">:</span> <span class="s1">&#39;complete&#39;</span><span class="p">});</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="o">:</span> <span class="s1">&#39;incomplete&#39;</span><span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>This will work just fine, but we should refactor this code
into the model, that way the view doesn't know too much about how
this model works, and we can change the model easier in the future.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Just tell the model to toggle it's status, the
model will do what is right</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">toggleStatus</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">toggleStatus</span><span class="p">();</span>
  <span class="p">}</span>

<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>And in our model, we define the <code>toggleStatus</code> function
to do just as it was doing in our view,
but instead of calling <code>this.model.get</code> and <code>this.model.set</code>,
we just call <code>this.get</code> and <code>this.set</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">TodoItem</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">toggleStatus</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;incomplete&#39;</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="o">:</span> <span class="s1">&#39;complete&#39;</span><span class="p">});</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="o">:</span> <span class="s1">&#39;incomplete&#39;</span><span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>This "refactor to the model" is a common pattern in Backbone.  It's a good
idea to move model specific functionality into the Model layer, that
way if ever need to toggle the status of the model instance from a different
view, you can use <code>this.model.toggleStatus()</code> and not have to define toggle
behavior in two or more different views.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>Model events</h3>

<p>Now that we our responding to the checkbox's <code>change</code> event and updating
our <code>todoItem</code>, we want to display to the user a reflection of the <code>todoItem's</code>
status.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>First let's update the <code>h3's</code> <code>class</code> to be the status of the <code>todoItem</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">template</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s1">&#39;&lt;h3 class=&quot;&lt;%= status %&gt;&quot;&gt;&lt;input type=checkbox &lt;%= status == &quot;complete&quot; ? &quot;checked=checked&quot; : &quot;&quot; %&gt;/&gt; &lt;%= description %&gt;&lt;/h3&gt;&#39;</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Let's assume we have a stylesheet with this declaration:</p>

<p><code>.complete { text-decoration: line-through; }</code></p>

<p>That means whenever the <code>h3's</code> class is <code>complete</code>, the text will have a strike-through
and the user will know they have successfully completed their TodoItem.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>So with this model</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">todoItem</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TodoItem</span><span class="p">({</span><span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;Pick up milk.&#39;</span><span class="p">,</span> <span class="nx">status</span><span class="o">:</span> <span class="s1">&#39;incomplete&#39;</span><span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>when we <code>render()</code> the view, the <code>h3's</code> class will equal <code>incomplete</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">todoView</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">todoView</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span> <span class="c1">// &lt;div&gt;&lt;h3 class=&quot;incomplete&quot;&gt;...&lt;/h3&gt;&lt;/div&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>So now we just need to update the view when the model changes.  So where do
we put the code to re-render the view when the model changes?</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Well, we could try putting it in the View's <code>toggleStatus</code> function, right?
Something like this:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">toggleStatus</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">toggleStatus</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>But now the view will only re-render when that <code>toggleStatus</code> function
is called.  What happens when we expand our app and our model instance's
status can get updated from another part of the UI?</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Well, you might remember that back in Level 2, we were able to listen
to <code>change</code> events on a model instance, and call a function when that
event fired.  And it would make sense that our view would be interested in
changes made to it's model, right?  </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>So, when we initialize our View, let's have the view tell the model to call
the view's <code>render</code> function whenever the model changes.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">TodoView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Backbone will automatically call this <code>initialize</code> function
when you do <code>var todoView = new TodoView({model: todoItem})</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p><code>bind</code> takes a third argument called the <code>context</code>
argument.  TODO explain <code>this</code> and crap.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>So now, whenever the model changes, the views <code>render</code> function is called, and the HTML
is re-generated.  We also don't have to worry about inserting the view's <code>el</code> into the DOM
because we only have to do that once, when we initially called <code>render</code>:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">todoView</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#app&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">todoView</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Now we are really starting to see some of the power that using Backbone
gives us.  Anytime this model instance is changed, no matter from where in the
UI, this on todoView will reflect the correct state to the user.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Putting everything together, our new View and Model look like this:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">TodoView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">template</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s1">&#39;&lt;h3 class=&quot;&lt;%= status %&gt;&quot;&gt;&lt;input type=checkbox &lt;%= status == &quot;complete&quot; ? &quot;checked=checked&quot; : &quot;&quot; %&gt;/&gt; &lt;%= description %&gt;&lt;/h3&gt;&#39;</span><span class="p">),</span>

  <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;change input&#39;</span><span class="o">:</span> <span class="s1">&#39;toggleStatus&#39;</span>
  <span class="p">},</span>

  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()));</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">toggleStatus</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">toggleStatus</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">TodoItem</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">toggleStatus</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;incomplete&#39;</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="o">:</span> <span class="s1">&#39;complete&#39;</span><span class="p">});</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="o">:</span> <span class="s1">&#39;incomplete&#39;</span><span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 