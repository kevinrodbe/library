<!DOCTYPE html>  <html> <head>   <title>2.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               2.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h3>Level 2 - Models</h3>

<p>As we saw in the last section, Model's are were
data is stored for your Backbone app.  Let's review
what we've learned so far.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Creating a Model class</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">TodoItem</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({});</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Creating a model instance</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">todoItem</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TodoItem</span><span class="p">({</span><span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;Pick up milk.&#39;</span><span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Getting an attribute value:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">todoItem</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)</span> <span class="c1">// &#39;Pick up milk.&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Setting an attribute value:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">todoItem</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;Pick up milk and cookies.&#39;</span><span class="p">})</span>
<span class="nx">todoItem</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)</span> <span class="c1">// &#39;Pick up milk and cookies.&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h4>Interacting with the server</h4>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>But if you remember back to our original jQuery code, we didn't
know what the data for the model was going to be ahead of time, but
instead it was loaded from a JSON Ajax call to a server.</p>

<p>Well, all Backbone models are backed by a server, and models know
how to do the Ajax requests necessary to get their data.  For this, Backbone
provides model's with the <code>fetch</code> method.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Create a new <code>TodoItem</code> instance without setting any attributes</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">todoItem</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TodoItem</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Oops, this code will throw an error:</p>

<p><code>Error: A "url" property or function must be specified</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">todoItem</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>We need to tell backbone the url for the Ajax request.  We can do so by 
setting the url on our <code>todoItem</code> instance</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">todoItem</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;/todo&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Now this will hit the <code>/todo</code> endpoint and populate the <code>todoItem</code> with the JSON data</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">todoItem</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>
<span class="nx">todoItem</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)</span> <span class="c1">// &#39;Pick up milk.&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>But something is wrong here, isn't it?  In a RESTful Rails application, 
wouldn't we get the <code>todoItem's</code> JSON using it's id? So instead of making
a request to <code>/todo</code> for a <code>todoItem</code> with <code>id=1</code>, we'd make a request to 
<code>/todos/1</code>. </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>To do this is Backbone, first you have to tell the model what the <code>urlRoot</code>
is (the part of the url before the <code>id</code>):</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">TodoItem</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">urlRoot</span><span class="o">:</span> <span class="s1">&#39;/todos&#39;</span><span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Now, when we create the <code>todoItem</code> object, we tell it what <code>id</code> to use</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">todoItem</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TodoItem</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">})</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>When calling <code>fetch()</code> now, Backbone will make a request to <code>/todos/1</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">todoItem</span><span class="p">.</span><span class="nx">fetch</span><span class="p">()</span> <span class="c1">// getJSON(&#39;/todos/1&#39;)</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Backbone also makes it easy to change a model object and save those changes to the server
using the <code>save()</code> function.  Let's say our Todo app lets the user update 
the description of the todo, and we want to save that update so when they use the app
later, their change will still be around.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>First, we change the description on the <code>todoItem</code> using <code>set</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">todoItem</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;Pick up milk and cookies.&#39;</span><span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>And when we want to save those change, we just call <code>save()</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">todoItem</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Since <code>todoItem</code> already has an <code>id</code>, Backbone will make a <code>PUT</code> request (<code>/todos/1</code>) to the server,
which in a RESTful Rails application means it will call the <code>update</code> 
action in your controller, passing all the <code>todoItem's</code> attributes in the params</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>If we create a brand new <code>TodoItem</code> and want it to be created on the server,
we still just call <code>save()</code>, but instead of Backbone making a <code>PUT</code> request <code>/todos/</code>,
it will do a <code>POST</code> to <code>/todos</code>.  This maps nicely to the way a RESTful Rails application
already works (sensing a theme yet?).</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Create a brand new <code>TodoItem</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">newTodoItem</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TodoItem</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Set some attributes</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">newTodoItem</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;Fill prescription.&#39;</span><span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Save it to the server</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">newTodoItem</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span> <span class="c1">// POST /todos</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>What if we want to create a new TodoItem and have it prepopulated with some
default values?  </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>When defining the model, pass in a <code>defaults</code> object</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">TodoItem</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">defaults</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;Empty todo...&#39;</span><span class="p">,</span>
    <span class="nx">status</span><span class="o">:</span> <span class="s1">&#39;incomplete&#39;</span>
  <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Now when creating a new TodoItem object, it's description and status will already be set:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">todoItem</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TodoItem</span><span class="p">();</span>
<span class="nx">todoItem</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)</span> <span class="c1">// &#39;Empty todo...&#39;</span>
<span class="nx">todoItem</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="c1">// &#39;incomplete&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h3>Events</h3>

<p>In Backbone, events play a big role in how applications are tied together.
For example, Views listen to changes in the Model and update the DOM based on those
changes.  We'll get into that more next level, but for now I want to show you
how you can listen to events on the model and trigger a function whenever 
those events are fired.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>To listen to an event, you use the <code>on</code> function 
(much like <a href="http://api.jquery.com/on/">jQuery's on</a>)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">todoItem</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;event-name&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){});</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>So now, whenever the <code>event-name</code> event is fired, the passed in <code>function</code>
will be called.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Model object's fire many different event types, <code>change</code> being one of the most common</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">todoItem</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;todoItem has changed&#39;</span><span class="p">);</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>So now, whenever you change an attribute on <code>todoItem</code>, this event will fire</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">todoItem</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;Changing my todo...&#39;</span><span class="p">});</span> <span class="c1">// alerts &#39;todoItem has changed&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>If you want to change an attribute on <code>todoItem</code> without a <code>change</code> event firing, you
can pass the <code>silent: true</code> option to <code>set</code>:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">todoItem</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span>
  <span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;Changing my todo again...&#39;</span>
<span class="p">},</span> <span class="p">{</span><span class="nx">silent</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span> <span class="c1">// no alerts</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Model objects also fire change events for individual attributes,
so instead of listening to all changes, you can focus on one attribute:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">todoitem</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change:status&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;todoItem status has changed&#39;</span><span class="p">);</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>We will see the full power of events when we use both models and views together
in a later chapter.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <h3>toJSON()</h3>

<p>Sometimes in Backbone you'll want easier access to all a Model instance's
attributes without having to call <code>model.get()</code> each time.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Calling <code>.toJSON</code> on a model instance will return an object with it's attributes</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="nx">todoItem</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">description</span><span class="p">);</span> <span class="c1">// &#39;Pick up milk.&#39;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span> <span class="c1">// &#39;incomplete&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>We'll be using <code>toJSON()</code> later on in the course in Views template rendering.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 